## Interception

### Description

We just captured this strange radio signal, on a frequency used by J3JuJ4 members.
We need you to decode it.

**Author: algorab**

### Solution

#### Step 1 : Analyzing the audio file

By analyzing the data, we can notice that the signal only contains two main frequencies, at 495Hz and 1985Hz.

![[spectrum.png]]

We can then think about frequency modulation, where one frequency will encode 0 and the other one will encode 1.

To find the correct length for each bit, we can look at the signal.

![[signal1.png]]

I we chose the smallest number of consecutive points where the frequency is the same, we will then know how many points are for one bit!

![[signal2.png]]

So, the length of one bit in this signal is 200 points.
We also notice that the first 8000 and last 8000 points of the data is only noise, and should then be ignored when recovering the data.

#### Step 2 : Recovering the data

Here is a recap of the info we have:
- Each bit is 200 points long, either on 495Hz or 1985Hz
- The first 8000 points should be ignored as the signal has not started yet

We can then recover the full bits sequence with this script:

```python
from scipy.io import wavfile
import numpy as np
import scipy.fftpack

cap = wavfile.read(f'capture.wav')
data = cap[1][8000:-8000]

bitstr = ""

for i in range(0, len(data)//200):
	yf = scipy.fftpack.fft(data[200*i:200*(i+1)])
	if np.argmax(np.abs(yf)) > 3:
		bitstr += "1"
	elif np.argmax(np.abs(yf)) <= 3:
		bitstr += "0"

print(bitstr)
```

We get as output:

```
1111111111111111111111111111111100000000000000000000000000000000001100000111100000110110011001010011001101100100001101000011010000110100001100010011001100110011001101000011000100110011001100000011001100110110001101000011011000110011001100000011001100110110001100110011100100110100001100010011001100110010001100110011000000110011001110000011001100110001100110100001101110011011101100001011000110011000001100001001100000110001000111001001100010011011000111001001110000011000100110101011000010110001101100110010010011011101100110001101100011000000110010011000010011011000110010011001100110001000111000001101100110010000111000001100110011011000110110001100100110010100110011000110011100100110101001101000110010001100010001110000011011100110111001110010110
[...] 0011001001100010001100110011001000110110001101110011001101100001001101000011100101100101001100000011100000110101011001000011100000111001001101110011011001100001001110010011001001100001011001010011000100110101011000100011010100110111001100000011100100110110001101100110011000110010001101010011010100110000001101110011011001100010111111111111111111111111111111110000000000000000000000000000000000110000011110000011010001100101001100110011000000110101001100000011010100110011001101110110001000110011001101010011011000110111001101000110010100110011001101000011011001100011001101010110011000110101001100000011011100110010001100110011000000110110001100110011001100110011001100110011010100110011001101010011001100110001001101000110010100110110001101110011010101100110001101100011011100110011001100000011010101100110001101000011001100110111001100100011001100110100001101110110000100110101001110010011011101100100
```

By looking at this bitstring, we can notice repetitive sequences of `1111111111111111111111111111111100000000000000000000000000000000`. These sequences seem to be regular. We can then think about some kind of preambule, between different chunks of data.
If we split the result in chunks of bits based on that preambule, we can then recover the original data.

```python
from scipy.io import wavfile
import numpy as np
import scipy.fftpack
  
PREAMBULE = "1111111111111111111111111111111100000000000000000000000000000000"  

cap = wavfile.read(f'capture.wav')
data = cap[1][8000:-8000]

bitstr = ""

for i in range(0, len(data)//200):
	yf = scipy.fftpack.fft(data[200*i:200*(i+1)])
	if np.argmax(np.abs(yf)) > 3:
		bitstr += "1"
	elif np.argmax(np.abs(yf)) <= 3:
		bitstr += "0"

bitstr = bitstr.split(PREAMBULE)[1:]

data = []

for block in bitstr:
	data.append(''.join([chr(int(block[i:i+8],2)) for i in range(0,len(block),8)]))

print("\n".join(data))
```

We get as output:

```
0x6e3d44413341303646303639413230383430353334414331323238384236383341364141423044323941304538363137443243434242364434413139374442354441333235343339463838383842374330364339393433413345463130463931443444304246364145463742373046443842454145384532373737424331393334363346454244453644434436434644364435414246443433334639323544423834364534334138373631354231303133373846364532363345334435324535463435323432324342344543413137343435324633464546384330344146363038384234453637443941413939323535374630454141363843323241454541383131
0x653d41453136444335443030354643463433303332383130373145443034313031444333413630434133323231463446384633344430464436314337384543333630413731323037343839344539444337364232304534414542323044334136343031433341424435324234323145354137324242373933443142333731454636374643383133364230453142383031393134444239394439323244314231384646303235373942423630393031443830353232393838333235334245383542373035334345383133443134453736313738374242423438353842463342423331434432444333314234433443423534313043303731344141453636303935393839
0x1b9a6f60516182a61eb6ab1b3cde9c84f9ac7bf9064ae75baf4fef65d2b62b47878b9fe44fb057dcff55ed32c477ac0a0b9169815acff5db9565861bf90fdf0f8d7b36f3363dbbe39f266b42cfd9472ad53e3af07ba74b5fd6fb11a7a0493b75f4849115b368123e08dc1a8b1db4b19a560ad5e2e2920615eec6b07f3a0375ce
0x1c7f32e7fef5048653958214a1dbe4f38a3d14ef5da06c5e9c6345194c406c98caca2943cc902d85011cb70f2d1056a4f23cd3848ff0d2c3de33148ef3a4c905397cdcc015a9d4bc4ea253182706851780b79bfe85f61209ae4ded4774059017f602a62fb86d83662e3c043e20b7e0e82be55fee93d1cb327406fab475f6b6b8
0x28bc1747ea69279a66bfb67349a3bf3d5bad6050d899bb1ebbf8645e847fa31e438b7b5986739f4e9ea90edcb34a6251b026f298450889e45de1784fcad16628539c954db8779b59e8342d49fff8155cb66eab34a52ac510fbb40a8c71e9cff80cf0a8ae1308ba406a09b5a2b32673a49e085d8976a92ae15b570966f255076b
0x4e3050537b35674e346c5f50723063333535314e675f67305f4372347a597d
```

The last chunk of data contains the flag.

### Flag

`N0PS{5gN4l_Pr0c3551Ng_g0_Cr4zY}`